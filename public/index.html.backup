<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Command Agent v3 - Transform your ideas into working applications with AI">
    <title>Command Agent v3 - AI Application Generator</title>
    <link rel="stylesheet" href="/styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Skip to main content for accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <!-- Header -->
    <header class="header" role="banner">
        <div class="container">
            <div class="header-content">
                <h1 class="logo">
                    <span class="logo-icon" aria-hidden="true">üöÄ</span>
                    Command Agent v3
                </h1>
                <p class="tagline">Transform your ideas into working applications</p>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main id="main-content" class="main" role="main">
        <div class="container">
            
            <!-- Step Indicator -->
            <div class="steps" role="navigation" aria-label="Progress steps">
                <div class="step active" data-step="1">
                    <div class="step-number" aria-label="Step 1">1</div>
                    <div class="step-label">Upload Requirements</div>
                </div>
                <div class="step" data-step="2">
                    <div class="step-number" aria-label="Step 2">2</div>
                    <div class="step-label">Review & Clarify</div>
                </div>
                <div class="step" data-step="3">
                    <div class="step-number" aria-label="Step 3">3</div>
                    <div class="step-label">Generate Code</div>
                </div>
                <div class="step" data-step="4">
                    <div class="step-number" aria-label="Step 4">4</div>
                    <div class="step-label">Download or Deploy</div>
                </div>
            </div>

            <!-- Step 1: Upload -->
            <section id="step-upload" class="step-content active" aria-labelledby="upload-heading">
                <h2 id="upload-heading" class="section-title">Upload Your Requirements</h2>
                <p class="section-description">
                    Share your project idea in any format. We support text files, Word documents, PDFs, and Markdown.
                </p>

                <div class="card">
                    <form id="upload-form" class="upload-form">
                        <div class="form-group">
                            <label for="project-name" class="form-label">
                                Project Name <span class="required" aria-label="required">*</span>
                            </label>
                            <input 
                                type="text" 
                                id="project-name" 
                                name="projectName" 
                                class="form-input" 
                                placeholder="e.g., Task Management App"
                                required
                                aria-required="true"
                            >
                        </div>

                        <div class="form-group">
                            <label for="project-description" class="form-label">
                                Project Description (Optional)
                            </label>
                            <textarea 
                                id="project-description" 
                                name="projectDescription" 
                                class="form-textarea" 
                                rows="3"
                                placeholder="Brief description of what you want to build..."
                            ></textarea>
                        </div>

                        <div class="form-group">
                            <label for="project-type" class="form-label">
                                Project Type
                            </label>
                            <select id="project-type" name="projectType" class="form-select">
                                <option value="application">Web Application</option>
                                <option value="api">API Backend</option>
                                <option value="fullstack">Full-Stack Application</option>
                                <option value="mobile">Mobile App</option>
                                <option value="other">Other</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="files" class="form-label">
                                Requirements Documents <span class="required" aria-label="required">*</span>
                            </label>
                            <div class="file-upload-area" id="file-upload-area">
                                <input 
                                    type="file" 
                                    id="files" 
                                    name="files" 
                                    multiple 
                                    accept=".txt,.md,.pdf,.docx,.doc"
                                    class="file-input"
                                    required
                                    aria-required="true"
                                    aria-describedby="file-help"
                                >
                                <div class="file-upload-content">
                                    <span class="upload-icon" aria-hidden="true">üìÅ</span>
                                    <p class="upload-text">
                                        <strong>Click to upload</strong> or drag and drop
                                    </p>
                                    <p class="upload-hint" id="file-help">
                                        TXT, MD, PDF, DOCX (max 50MB per file)
                                    </p>
                                </div>
                            </div>
                            <div id="file-list" class="file-list" role="list"></div>
                        </div>

                        <button type="submit" class="btn btn-primary btn-large" id="upload-btn">
                            <span class="btn-text">Upload & Analyze</span>
                            <span class="btn-icon" aria-hidden="true">‚Üí</span>
                        </button>
                    </form>
                </div>
            </section>

            <!-- Step 2: Analysis & Questions -->
            <section id="step-analysis" class="step-content" aria-labelledby="analysis-heading" hidden>
                <h2 id="analysis-heading" class="section-title">Review Analysis & Answer Questions</h2>
                
                <div class="card">
                    <h3 class="card-title">Project Analysis</h3>
                    <div id="analysis-summary" class="analysis-summary"></div>
                </div>

                <div class="card">
                    <h3 class="card-title">Clarifying Questions</h3>
                    <p class="card-description">
                        Help us understand your requirements better by answering these questions:
                    </p>
                    <form id="questions-form" class="questions-form"></form>
                </div>

                <div class="button-group">
                    <button type="button" class="btn btn-secondary" id="back-to-upload-btn">
                        <span class="btn-icon" aria-hidden="true">‚Üê</span>
                        <span class="btn-text">Back</span>
                    </button>
                    <button type="button" class="btn btn-primary btn-large" id="generate-btn">
                        <span class="btn-text">Generate Application</span>
                        <span class="btn-icon" aria-hidden="true">‚ú®</span>
                    </button>
                </div>
            </section>

            <!-- Step 3: Generation -->
            <section id="step-generation" class="step-content" aria-labelledby="generation-heading" hidden>
                <h2 id="generation-heading" class="section-title">Generating Your Application</h2>
                <p class="section-description">
                    Please wait while we create your application. This may take a few minutes.
                </p>

                <div class="card">
                    <div class="progress-container">
                        <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                            <div class="progress-fill" id="progress-fill"></div>
                        </div>
                        <p class="progress-text" id="progress-text">Initializing...</p>
                    </div>

                    <div id="generation-log" class="generation-log" role="log" aria-live="polite" aria-atomic="false"></div>
                </div>
            </section>

            <!-- Step 4: Download -->
            <section id="step-download" class="step-content" aria-labelledby="download-heading" hidden>
                <h2 id="download-heading" class="section-title">Your Application is Ready!</h2>
                <p class="section-description">
                    Download your generated application or push it directly to GitHub.
                </p>

                <div class="card">
                    <div class="success-message">
                        <span class="success-icon" aria-hidden="true">‚úÖ</span>
                        <h3>Generation Complete!</h3>
                        <p id="generation-summary"></p>
                    </div>

                    <div class="button-group">
                        <button type="button" class="btn btn-primary btn-large" id="download-btn">
                            <span class="btn-icon" aria-hidden="true">‚¨áÔ∏è</span>
                            <span class="btn-text">Download ZIP</span>
                        </button>
                        <button type="button" class="btn btn-secondary" id="github-btn">
                            <span class="btn-icon" aria-hidden="true">üîó</span>
                            <span class="btn-text">Push to GitHub</span>
                        </button>
                    </div>

                    <button type="button" class="btn btn-text" id="new-project-btn">
                        Start New Project
                    </button>
                </div>
            </section>

            <!-- GitHub Modal -->
            <div id="github-modal" class="modal" role="dialog" aria-labelledby="github-modal-title" aria-modal="true" hidden>
                <div class="modal-overlay" id="modal-overlay"></div>
                <div class="modal-content">
                    <h3 id="github-modal-title" class="modal-title">Push to GitHub</h3>
                    <form id="github-form" class="modal-form">
                        <div class="form-group">
                            <label for="github-token" class="form-label">
                                GitHub Personal Access Token <span class="required">*</span>
                            </label>
                            <input 
                                type="password" 
                                id="github-token" 
                                class="form-input" 
                                required
                                aria-describedby="token-help"
                            >
                            <p id="token-help" class="form-hint">
                                <a href="https://github.com/settings/tokens" target="_blank" rel="noopener">
                                    Create a token
                                </a> with 'repo' scope
                            </p>
                        </div>

                        <div class="form-group">
                            <label for="repo-name" class="form-label">
                                Repository Name <span class="required">*</span>
                            </label>
                            <input 
                                type="text" 
                                id="repo-name" 
                                class="form-input" 
                                required
                                placeholder="my-awesome-app"
                            >
                        </div>

                        <div class="form-group">
                            <label for="repo-description" class="form-label">
                                Description (Optional)
                            </label>
                            <textarea 
                                id="repo-description" 
                                class="form-textarea" 
                                rows="2"
                            ></textarea>
                        </div>

                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="repo-private" checked>
                                <span>Make repository private</span>
                            </label>
                        </div>

                        <div class="button-group">
                            <button type="button" class="btn btn-secondary" id="cancel-github-btn">
                                Cancel
                            </button>
                            <button type="submit" class="btn btn-primary">
                                Push to GitHub
                            </button>
                        </div>
                    </form>
                </div>
            </div>

        </div>
    </main>

    <!-- Footer -->
    <footer class="footer" role="contentinfo">
        <div class="container">
            <p>&copy; 2025 Almost Magic Tech Lab. Built with ‚ù§Ô∏è for developers.</p>
        </div>
    </footer>

    <!-- Toast Notifications -->
    <div id="toast-container" class="toast-container" role="status" aria-live="polite"></div>

    <!-- Scripts -->
    <script src="/socket.io/socket.io.js"></script>
    <script src="/app.js"></script>
</body>
</html>

        <!-- Stage 2: Analysis Progress -->
        <div id="analysisStage" class="workflow-stage" style="display: none;">
            <div class="stage-header">
                <h2>Analysing Your Requirements</h2>
                <p>Our AI is reviewing your requirements document...</p>
            </div>
            
            <div class="progress-container">
                <div class="progress-item">
                    <div class="progress-label">
                        <span>Analysis Progress</span>
                        <span id="analysisPercent">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div id="analysisProgressBar" class="progress-fill"></div>
                    </div>
                </div>
                
                <div class="progress-item">
                    <div class="progress-label">
                        <span>Token Usage</span>
                        <span id="tokenPercent">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div id="tokenProgressBar" class="progress-fill"></div>
                    </div>
                </div>
                
                <div class="progress-item">
                    <div class="progress-label">
                        <span>Estimated Time Remaining</span>
                        <span id="timeRemaining">Calculating...</span>
                    </div>
                </div>
                
                <div class="status-message" id="analysisStatus">
                    <div class="spinner"></div>
                    <span>Analysing requirements...</span>
                </div>
            </div>
        </div>

        <!-- Stage 3: Questions -->
        <div id="questionsStage" class="workflow-stage" style="display: none;">
            <div class="stage-header">
                <h2>We Have Some Questions</h2>
                <p>Help us understand your requirements better by answering these intelligent questions:</p>
            </div>
            
            <div id="questionsList" class="questions-container"></div>
            
            <div class="button-group">
                <button onclick="submitAnswers()" class="btn btn-primary">Submit Answers</button>
                <button onclick="skipQuestions()" class="btn btn-secondary">Skip Questions</button>
            </div>
        </div>

        <!-- Stage 4: Confirmation -->
        <div id="confirmationStage" class="workflow-stage" style="display: none;">
            <div class="stage-header">
                <h2>Here's What We Understand</h2>
                <p>Please review our understanding of your requirements:</p>
            </div>
            
            <div id="understandingText" class="understanding-box"></div>
            
            <div class="button-group">
                <button onclick="confirmUnderstanding()" class="btn btn-primary">Yes, That's Correct</button>
                <button onclick="editUnderstanding()" class="btn btn-secondary">Make Changes</button>
            </div>
        </div>

        <!-- Stage 5: Knowledge Graph -->
        <div id="knowledgeGraphStage" class="workflow-stage" style="display: none;">
            <div class="stage-header">
                <h2>System Architecture</h2>
                <p>Here's a visual representation of how your application will work:</p>
            </div>
            
            <div id="knowledgeGraphContainer" class="knowledge-graph-container">
                <canvas id="knowledgeGraphCanvas"></canvas>
            </div>
            
            <div class="button-group">
                <button onclick="approveKnowledgeGraph()" class="btn btn-primary">Approve & Generate Code</button>
                <button onclick="requestChanges()" class="btn btn-secondary">Request Changes</button>
            </div>
        </div>

        <!-- Stage 6: Code Generation -->
        <div id="generationStage" class="workflow-stage" style="display: none;">
            <div class="stage-header">
                <h2>Generating Your Application</h2>
                <p>We're creating your application code now...</p>
            </div>
            
            <div class="progress-container">
                <div class="progress-item">
                    <div class="progress-label">
                        <span>Generation Progress</span>
                        <span id="generationPercent">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div id="generationProgressBar" class="progress-fill"></div>
                    </div>
                </div>
                
                <div class="status-message" id="generationStatus">
                    <div class="spinner"></div>
                    <span>Generating code...</span>
                </div>
                
                <div id="generationLog" class="generation-log"></div>
            </div>
        </div>

        <!-- Stage 7: Deployment Options -->
        <div id="deploymentStage" class="workflow-stage" style="display: none;">
            <div class="stage-header">
                <h2>Your Application is Ready!</h2>
                <p>Choose how you'd like to proceed:</p>
            </div>
            
            <div class="deployment-options">
                <div class="deployment-option">
                    <div class="option-icon">üì¶</div>
                    <h3>Download ZIP</h3>
                    <p>Download your application as a ZIP file</p>
                    <button onclick="downloadZip()" class="btn btn-primary">Download</button>
                </div>
                
                <div class="deployment-option">
                    <div class="option-icon">üêô</div>
                    <h3>Push to GitHub</h3>
                    <p>Push your code directly to a GitHub repository</p>
                    <button onclick="showGitHubOptions()" class="btn btn-primary">Push to GitHub</button>
                </div>
                
                <div class="deployment-option highlighted">
                    <div class="option-icon">üöÄ</div>
                    <h3>Deploy Marketing Website</h3>
                    <p>Auto-create and deploy a marketing website + application for testing</p>
                    <button onclick="deployMarketingWebsite()" class="btn btn-primary btn-highlight">Deploy Now</button>
                </div>
            </div>
            
            <div class="chat-section">
                <h3>Need Modifications?</h3>
                <div id="chatMessages" class="chat-messages"></div>
                <div class="chat-input-group">
                    <input type="text" id="chatInput" placeholder="Describe the changes you'd like..." />
                    <button onclick="sendChatMessage()" class="btn btn-primary">Send</button>
                </div>
            </div>
        </div>

        <!-- Stage 8: Marketing Website Deployed -->
        <div id="marketingDeployedStage" class="workflow-stage" style="display: none;">
            <div class="stage-header success">
                <h2>üéâ Your Application is Live!</h2>
                <p>Your marketing website and application have been deployed successfully</p>
            </div>
            
            <div class="deployed-links">
                <div class="link-box">
                    <h3>Marketing Website</h3>
                    <a id="marketingUrl" href="#" target="_blank" class="deployed-url"></a>
                </div>
                
                <div class="link-box">
                    <h3>Application</h3>
                    <a id="appUrl" href="#" target="_blank" class="deployed-url"></a>
                </div>
            </div>
            
            <div class="final-options">
                <h3>What's Next?</h3>
                <div class="button-group">
                    <button onclick="downloadAll()" class="btn btn-primary">Download Everything</button>
                    <button onclick="pushToGitHub()" class="btn btn-primary">Push to GitHub</button>
                    <button onclick="startNew()" class="btn btn-secondary">Create Another App</button>
                </div>
            </div>
        </div>
    </div>

    <script src="/app.js"></script>
</body>
</html>
